---
title: "Homework 2"
author: "Aleister Montfort"
date: "1/29/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(ggplot2)
library(here)
library(zoo)
#library(lubridate)
library(dplyr)
```

```{r, load data, include=FALSE}
here()
path = here("death_certificates.RData")
print(path)
data = load(path)
```
```{r, other data, include=FALSE}
# here()
# path_gini10 = here::here("gini2010.RData")
# load(path_gini10)
# typeof(gini2010)
# file.exists(path_gini10)
# path_gini15 = here::here("gini2015.RData")
# file.exists(path_gini15)
# gini2015 = load(path_gini15)
# pathiris = here::here("irs.RData")
# file.exists(pathiris)
# irs = load(pathiris)
load("~/Documents/Chicago_2018_2019/Winter 2019/Data viz/data_viz_work/gini2015.RData")
load("~/Documents/Chicago_2018_2019/Winter 2019/Data viz/data_viz_work/gini2010.RData")
load("~/Documents/Chicago_2018_2019/Winter 2019/Data viz/data_viz_work/irs.RData")

```

```{r, message=FALSE}
ggplot(gini2010, aes(x=gini, y=income_ratio)) + geom_point()

```
```{r}
library(here)
path = here::here("irs.RData")
file.exists(path)
irs = load(path)

```



```{r, prepare data chart 1, include=FALSE}

death_certificates <- subset(death_certificates, year_death>1997 & year_death!=9999)
## CREATE YEAR MONTH VAR ####
death_certificates$yearmonth <- as.yearmon(paste(death_certificates$year_death, death_certificates$month_death), "%Y %m")

death_certificates <- death_certificates%>%
    mutate(non_natural_causes = if_else(is.na(non_natural_causes), "N.A/Natural Death", non_natural_causes))

monthly_death_national <-
  death_certificates %>% 
  group_by(yearmonth, ANIO_OCUR, non_natural_causes) %>% 
  tally()
print.data.frame(head(monthly_death_national))

```


```{r, adding population, include=FALSE}
# library(lubridate)
# monthly_death_national<- 
#   monthly_death_national %>%
#   mutate(year=year(yearmonth))

## ADD POPULATION TO OBTAIN RATES 
load("~/Documents/Chicago_2018_2019/Winter 2019/Data viz/data_viz_work/gini2015.RData")
load("~/Documents/Chicago_2018_2019/Winter 2019/Data viz/data_viz_work/gini2010.RData")
load("~/Documents/Chicago_2018_2019/Winter 2019/Data viz/data_viz_work/irs.RData")
monthly_death_national<-
  monthly_death_national %>% mutate(pop_divide = case_when(ANIO_OCUR<=2002 ~ sum(as.numeric(irs$pop2000), na.rm = TRUE),
                                          ANIO_OCUR>2002 & ANIO_OCUR<=2008 ~ sum(as.numeric(irs$pop2005), na.rm = TRUE),
                                          ANIO_OCUR>2008 & ANIO_OCUR<= 2013 ~ sum(as.numeric(irs$pop2010), na.rm=TRUE),
                                          ANIO_OCUR>2013 ~ sum(as.numeric(irs$pop2015), na.rm=TRUE)))
mult<-100000
monthly_death_national<-monthly_death_national %>% 
                        mutate(death_rate=n/pop_divide*mult)
                      
```

```{r, final_manipulation}
library(ggplot2)
## Suicides ####
suicide_plot=ggplot(subset(monthly_death_national,non_natural_causes %in% c("Suicide")), aes(x=yearmonth, y=death_rate)) +
  geom_line() +ylab('Monthly Rate') +
  geom_line(col="blue", alpha=.6)  +
  # stat_smooth(
  #   color = "#FC4E07", alpha=.04,
  #   method = "loess", se = FALSE) +
  xlab("") +
  theme_bw() +
  theme(axis.title.y = element_text(size=12))
suicide_plot

## Homicides ####
homicide_plot=ggplot(subset(monthly_death_national,non_natural_causes %in% c("Suicide")), aes(x=yearmonth, y=death_rate)) +
  geom_line() +ylab('Monthly Rate') +
  geom_line(col="blue", alpha=.6)  +
  # stat_smooth(
  #   color = "#FC4E07", alpha=.04,
  #   method = "loess", se = FALSE) +
  geom_vline(xintercept =2006.917 , linetype="dotted", 
                color = "red", size=1)+ 
    geom_text(aes(x=2009.2, label="War on drugs starts", y=.20), colour="red") +

  xlab("") +
  theme_bw()+
  theme(axis.title.y = element_text(size=12))
homicide_plot
```


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r, graphs, warning=FALSE, message=FALSE, error=FALSE}
print(de)

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
